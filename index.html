<!DOCTYPE html><html><head><meta charset="utf-8"><title>- aLice -.md</title><style></style></head><body id="preview">
<h1 class="code-line" data-line-start="0" data-line-end="1"><a id="_aLice__0"></a>- aLice -</h1>
<p class="has-line-data" data-line-start="2" data-line-end="4">- aLice -はSymbolアカウントで署名ができるMobileAppです。<br>
ユーザーはSymbolアカウントの秘密鍵をユーザが設定するパスワードにて暗号化し端末に保存しています。</p>
<p class="has-line-data" data-line-start="5" data-line-end="6">他のMobileAppやwebサイトから署名が必要なデータを送ることでユーザが署名し署名データを返すことができます。</p>
<p class="has-line-data" data-line-start="7" data-line-end="8">- aLice - が出来ることは以下です</p>
<ol>
<li class="has-line-data" data-line-start="9" data-line-end="10">公開鍵を渡す</li>
<li class="has-line-data" data-line-start="10" data-line-end="15">署名する
<ul>
<li class="has-line-data" data-line-start="11" data-line-end="12">Symbolトランザクションへの署名</li>
<li class="has-line-data" data-line-start="12" data-line-end="13">UTF-8文字列への署名</li>
<li class="has-line-data" data-line-start="13" data-line-end="15">バイナリデータへの署名（要16進数文字列化）</li>
</ul>
</li>
</ol>
<h3 class="code-line" data-line-start="15" data-line-end="16"><a id="URL_15"></a>カスタムURLスキーム</h3>
<p class="has-line-data" data-line-start="17" data-line-end="18">- aLice - のカスタムURLスキームは <code>alice://</code> です。prefixには<code>sign</code>を使います。</p>
<h3 class="code-line" data-line-start="19" data-line-end="20"><a id="_19"></a>クエリパラメータ</h3>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th>クエリパラメータ</th>
<th>値</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>request_sign_transaction, request_sign_utf8, request_sign_binary_hex, request_pubkey</td>
</tr>
<tr>
<td>data</td>
<td>署名するデータ(string)</td>
</tr>
<tr>
<td>callback</td>
<td><a href="https://hogehoge.com/callback">https://hogehoge.com/callback</a>, sampleApp://callback/</td>
</tr>
</tbody>
</table>
<p class="has-line-data" data-line-start="26" data-line-end="28">ex)<br>
<code>alice://sign?data={data}&amp;type={request_type}&amp;callback={callbackURL}</code></p>
<h3 class="code-line" data-line-start="29" data-line-end="30"><a id="request_sign_transaction_29"></a>request_sign_transaction</h3>
<p class="has-line-data" data-line-start="30" data-line-end="31">Symbolのトランザクションペイロードに署名します。</p>
<pre><code class="has-line-data" data-line-start="32" data-line-end="48" class="language-javascript"><span class="hljs-keyword">const</span> transaction = facade.transactionFactory.create({
    type: <span class="hljs-string">'transfer_transaction_v1'</span>,
    signerPublicKey: aliceKeyPair.publicKey,
    recipientAddress: <span class="hljs-string">'BOB_PLAIN_ADDRESS'</span>,
    mosaics: [
        { 
            mosaicId: <span class="hljs-number">0x72C0212E67A08BCE</span>n,
            amount: <span class="hljs-number">1</span>_000000n 
        }
    ],
    message: [<span class="hljs-number">0</span>,...(<span class="hljs-keyword">new</span> TextEncoder(<span class="hljs-string">'utf-8'</span>)).encode(<span class="hljs-string">'Hello, Symbol!!'</span>)],
    fee: <span class="hljs-number">1</span>_000000n,
    deadline,
});
<span class="hljs-keyword">const</span> payload = symbolSdk.utils.uint8ToHex(transaction.serialize());
</code></pre>
<p class="has-line-data" data-line-start="48" data-line-end="49"><code>alice://sign?type=request_sign_transaction&amp;data={payload}&amp;callback={callbackURL}</code></p>
<p class="has-line-data" data-line-start="50" data-line-end="51">sdk v2系の場合はhexへのコンバートは不要です</p>
<pre><code class="has-line-data" data-line-start="52" data-line-end="55" class="language-javascript"><span class="hljs-comment">// v2</span>
<span class="hljs-keyword">const</span> payload = transaction.serialize();
</code></pre>
<blockquote>
<p class="has-line-data" data-line-start="56" data-line-end="57">Note: トランザクションのSignerPublicKeyはユーザが設定しているメインアカウントの公開鍵が自動的に設定されます。</p>
</blockquote>
<p class="has-line-data" data-line-start="58" data-line-end="59">以下をCallbackURLに返します。</p>
<p class="has-line-data" data-line-start="60" data-line-end="61"><code>{callbackUrl}?signed_payload={signedPayload}&amp;pubkey={publicKey}&amp;original_data={data}</code></p>
<p class="has-line-data" data-line-start="62" data-line-end="63">signedPayloadは以下のように扱います</p>
<pre><code class="has-line-data" data-line-start="64" data-line-end="75" class="language-javascript"><span class="hljs-comment">// v2 v2系では一度再構築しなおす必要があります</span>
<span class="hljs-keyword">const</span> hash = Transaction.createTransactionHash(payload, [... Convert.hexToUint8(generationHash)])
<span class="hljs-keyword">const</span> signed = TransactionMapping.createFromPayload(payload);
<span class="hljs-keyword">const</span> signedTx = <span class="hljs-keyword">new</span> SignedTransaction(payload, hash, signed.signer?.publicKey!, signed.type, signed.type)

<span class="hljs-comment">// v3 v3系ではそのままpayloadとして扱えますがput送信する時には以下のように扱う</span>
<span class="hljs-keyword">const</span> jsonObject = {
    payload: payload
};
<span class="hljs-keyword">const</span> d = <span class="hljs-built_in">JSON</span>.stringify(jsonObject);
</code></pre>
<blockquote>
<p class="has-line-data" data-line-start="75" data-line-end="76">Note: ここでのoriginal_dataは送信時のhex_payloadです。</p>
</blockquote>
<h3 class="code-line" data-line-start="76" data-line-end="77"><a id="request_sign_utf8_76"></a>request_sign_utf8</h3>
<p class="has-line-data" data-line-start="77" data-line-end="79">UTF8文字列に署名します<br>
<code>alice://sign?type=request_sign_utf8&amp;data=hello,symbol!&amp;callback={callbackURL}</code></p>
<p class="has-line-data" data-line-start="80" data-line-end="82">以下をCallbackURLに返します。<br>
<code>{callbackUrl}?signature={signature}&amp;pubkey={publicKey}&amp;original_data={data}</code></p>
<h3 class="code-line" data-line-start="83" data-line-end="84"><a id="request_sign_binary_hex_83"></a>request_sign_binary_hex</h3>
<p class="has-line-data" data-line-start="84" data-line-end="85">バイナリデータに署名します</p>
<pre><code class="has-line-data" data-line-start="86" data-line-end="91" class="language-javascript"><span class="hljs-comment">// v3</span>
<span class="hljs-keyword">const</span> data = symbolSdk.utils.uint8ToHex(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>]))
<span class="hljs-comment">// v2</span>
<span class="hljs-keyword">const</span> data = Convert.uint8ToHex(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>]))
</code></pre>
<p class="has-line-data" data-line-start="91" data-line-end="92"><code>alice://sign?type=request_sign_binary_hex&amp;data={data}&amp;callback={callbackURL}</code></p>
<p class="has-line-data" data-line-start="93" data-line-end="95">以下をCallbackURLに返します。<br>
<code>{callbackUrl}?signature={signature}&amp;pubkey={publicKey}&amp;original_data={data}</code></p>
<h3 class="code-line" data-line-start="96" data-line-end="97"><a id="request_pubkey_96"></a>request_pubkey</h3>
<p class="has-line-data" data-line-start="97" data-line-end="98">ユーザが - aLice - のメインに設定しているアカウントの公開鍵(string)を返します。</p>
<h3 class="code-line" data-line-start="99" data-line-end="100"><a id="_99"></a>エラーについて</h3>
<p class="has-line-data" data-line-start="100" data-line-end="101">ユーザが署名を拒否すると以下を返します</p>
<p class="has-line-data" data-line-start="102" data-line-end="103"><code>{callback}?error=sign_rejected</code></p>
</body></html>
